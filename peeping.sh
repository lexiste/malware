#!/usr/bin/env bash

##
## the find might look messy, but pastebin names are 8 characters, this allows
## us to match the name is that length, couldn't make a regex .{8} work
##

for i in $(find . -maxdepth 1 -type f -name "????????" | grep -v peep | grep -v malware); do
   vim -RC $i
   ## ask to save file or not and read in the response
   read -n 1 -p "Save file? [y|n]: " delete
   echo

   ## now take action based on the decision...
   if [ ${delete} == "n" ]; then
      shred -n5 -u --zero $i

   elif [ ${delete} == "y" ]; then
      read -p "  File extension: " ext

      date=$(/bin/date +%b%d)
      if [ ! -d "archive/${date}" ]; then
         mkdir "archive/${date}"
      fi
      rand=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 16 | head -n 1)
      mv $i "archive/${date}/${rand}.${ext}"
      echo "[$(/bin/date +%Y%b%d\ %T)] moving ${i} to ${rand}.${ext}" >> peeping.log

   elif [ ${delete} == "q" ]; then
      echo "opted to exit without processing all pastebin files..."
      exit
   fi
done
