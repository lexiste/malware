#!/usr/bin/env bash

##
## the find might look messy, but pastebin names are 8 characters, this allows
## us to match the name is that length, couldn't make a regex .{8} work
##

for i in $(find . -maxdepth 1 -type f -name "????????" | grep -v peep | grep -v malware); do
   vim $i
   echo -n "Save file? [y/n]: "
   read delete
   if [ ${delete} == "n" ]; then
      shred -n5 -u --zero $i
   elif [ ${delete} == "y" ]; then
      echo -n "File extension: "
      read ext

      date=$(/bin/date +%b%d)
      if [ ! -d "archive/${date}" ]; then
         mkdir "archive/${date}"
      fi
      rand=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 16 | head -n 1)
      mv $i "archive/${date}/${rand}.${ext}"
      echo "[$(/bin/date +%Y%b%d\ %T)] moving ${i} to ${rand}.${ext}" >> peeping.log
   fi
done
